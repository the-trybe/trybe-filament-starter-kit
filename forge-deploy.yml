server_name: "my-server"
github_repository: "user/repo"
github_branch: "main"

sites:
  - site_domain: "my.site.com"

    deployment_commands: |
      $FORGE_COMPOSER install --no-dev --no-interaction --prefer-dist --optimize-autoloader

      ( flock -w 10 9 || exit 1
          echo 'Restarting FPM...'; sudo -S service $FORGE_PHP_FPM reload ) 9>/tmp/fpmlock

      if [ -f artisan ]; then
          $FORGE_PHP artisan migrate --force
          $FORGE_PHP artisan config:cache
          $FORGE_PHP artisan horizon:terminate
      fi

    environment: |
      APP_NAME=
      APP_ENV=production
      APP_KEY=${{ secrets.MAIN_APP_KEY }}
      APP_DEBUG=false
      APP_URL=
      UI_URL=

      LOG_CHANNEL=stack
      LOG_DEPRECATIONS_CHANNEL=null
      LOG_LEVEL=debug

      DB_CONNECTION=mysql
      DB_HOST=127.0.0.1
      DB_PORT=3306
      DB_DATABASE=
      DB_USERNAME=${{ secrets.DB_USERNAME }}
      DB_PASSWORD="${{ secrets.DB_PASSWORD }}"

      BROADCAST_DRIVER=log
      CACHE_DRIVER=redis
      FILESYSTEM_DISK=s3
      QUEUE_CONNECTION=redis
      SESSION_DRIVER=file
      SESSION_LIFETIME=120

      MEMCACHED_HOST=127.0.0.1

      REDIS_HOST=127.0.0.1
      REDIS_PASSWORD=null
      REDIS_PORT=6379

      MAIL_MAILER=smtp
      MAIL_HOST=
      MAIL_PORT=
      MAIL_USERNAME=
      MAIL_PASSWORD=
      MAIL_ENCRYPTION=tls
      MAIL_FROM_ADDRESS=
      MAIL_FROM_NAME="${APP_NAME}"

    project_type: "php"
    php_version: "php84"
    certificate: true
    laravel_scheduler: true
    daemons:
      - command: "php8.4 artisan horizon"
